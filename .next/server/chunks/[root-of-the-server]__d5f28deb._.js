module.exports=[70406,(e,t,a)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},94131,(e,t,a)=>{t.exports=e.x("@supabase/supabase-js",()=>require("@supabase/supabase-js"))},15803,e=>{"use strict";e.s(["config",()=>m,"default",()=>h,"handler",()=>f],15803);var t=e.i(26747),a=e.i(90406),s=e.i(44898),r=e.i(62950);e.s(["default",()=>d],28029);var i=e.i(94131);let n=process.env.SUPABASE_SERVICE_ROLE_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxeWZwbGlmZXl2a2lsa29uZXBoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU4MzA2NTQsImV4cCI6MjA1MTQwNjY1NH0.ydowrDwep95J1DlPalzdCIKlk5XAxNWClySjvPn-gVc",o=(0,i.createClient)("https://bqyfplifeyvkilkoneph.supabase.co",n,{auth:{persistSession:!1}});function l(e,t,a){return e.status(t).json({success:!1,error:a})}async function d(e,t){if("GET"!==e.method)return l(t,405,"Method not allowed");let{session_id:a,after:s,limit:r}=e.query,i=Math.min(Math.max(parseInt(r||"100",10)||100,1),500);try{if(a){let e=o.from("loan_tracker_chat_messages").select("id,session_id,role,content,response_json,action,need_followup,created_at").eq("session_id",a).order("created_at",{ascending:!0}).limit(i);s&&(e=e.gt("created_at",s));let{data:r,error:n}=await e;if(n)throw n;return t.status(200).json({success:!0,data:{session_id:a,messages:r??[]}})}let{data:e,error:r}=await o.from("loan_tracker_chat_messages").select("session_id,created_at,role,content").order("created_at",{ascending:!1}).limit(1e3);if(r)throw r;let n=new Map;(e??[]).forEach(e=>{let t=e.session_id,a=new Date(e.created_at).toISOString(),s=n.get(t);s?(s.message_count+=1,s.started_at=a<s.started_at?a:s.started_at,s.last_at=a>s.last_at?a:s.last_at):n.set(t,{session_id:t,message_count:1,started_at:a,last_at:a,last_snippet:(e.content||"").toString().slice(0,140)})});let l=Array.from(n.values()).sort((e,t)=>t.last_at.localeCompare(e.last_at)).slice(0,Math.min(i,200));return t.status(200).json({success:!0,data:{sessions:l}})}catch(e){return console.error("[/api/chats] error:",e),l(t,500,e?.message||"Unexpected error")}}var c=e.i(28029),p=e.i(7031),u=e.i(81927);let h=(0,r.hoist)(c,"default"),m=(0,r.hoist)(c,"config"),_=new s.PagesAPIRouteModule({definition:{kind:a.RouteKind.PAGES_API,page:"/api/chats",pathname:"/api/chats",bundlePath:"",filename:""},userland:c,distDir:".next",relativeProjectDir:""});async function f(e,a,s){let r="/api/chats";r=r.replace(/\/index$/,"")||"/";let i=await _.prepare(e,a,{srcPage:r});if(!i){a.statusCode=400,a.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve());return}let{query:n,params:o,prerenderManifest:l,routerServerContext:d}=i;try{let t=e.method||"GET",s=(0,p.getTracer)(),r=s.getActiveScopeSpan(),i=_.instrumentationOnRequestError.bind(_),c=async r=>_.render(e,a,{query:{...n,...o},params:o,allowedRevalidateHeaderKeys:[],multiZoneDraftMode:!1,trustHostHeader:!1,previewProps:l.preview,propagateError:!1,dev:_.isDev,page:"/api/chats",internalRevalidate:null==d?void 0:d.revalidate,onError:(...t)=>i(e,...t)}).finally(()=>{if(!r)return;r.setAttributes({"http.status_code":a.statusCode,"next.rsc":!1});let i=s.getRootSpanAttributes();if(!i)return;if(i.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${i.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=i.get("next.route");if(n){let e=`${t} ${n}`;r.setAttributes({"next.route":n,"http.route":n,"next.span_name":e}),r.updateName(e)}else r.updateName(`${t} ${e.url}`)});r?await c(r):await s.withPropagatedContext(e.headers,()=>s.trace(u.BaseServerSpan.handleRequest,{spanName:`${t} ${e.url}`,kind:p.SpanKind.SERVER,attributes:{"http.method":t,"http.target":e.url}},c))}catch(e){if(_.isDev)throw e;(0,t.sendError)(a,500,"Internal Server Error")}finally{null==s.waitUntil||s.waitUntil.call(s,Promise.resolve())}}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d5f28deb._.js.map